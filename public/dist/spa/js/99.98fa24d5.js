(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[99,797],{4261:(e,a,t)=>{"use strict";function s(){const e=JSON.parse(localStorage.getItem("userInfo"));return e||{}}t.d(a,{V:()=>s})},5099:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>L});t(6801);var s=t(3673),r=t(2323),n=t(8880);const l=(0,s.Uk)("Disturb"),o={class:"column items-center"},u=(0,s.Wm)("div",null,[(0,s.Wm)("div",{class:"row"},[(0,s.Wm)("span",{class:"text-body-2 text-center text-grey-5 q-ml-lg q-pl-lg"},[(0,s.Wm)("b",null," Sin conversaciones ")])]),(0,s.Wm)("div",{class:"row"},[(0,s.Wm)("span",{class:"text-body-2 text-center text-grey-5"}," prueba buscando a usuarios por su nombre ")])],-1),i=(0,s.Wm)("div",null,[(0,s.Wm)("div",{class:"row align-items-center"},[(0,s.Wm)("span",{class:"text-body-2 text-center text-grey-5 q-ml-lg q-pl-lg"},[(0,s.Uk)(" consejo de "),(0,s.Wm)("b",null,"pros"),(0,s.Uk)(": ")])]),(0,s.Wm)("div",{class:"row"},[(0,s.Wm)("span",{class:"text-body-2 text-center text-grey-5 q-ml-lg q-pl-lg"},' pulsa "Enter" para buscar ')])],-1),c={class:"seccion-usuarios q-mt-md"},m={class:"seccion-lista-usuarios"},d={class:"usuario"},p={class:"avatar"},g={class:"cuerpo"},v={class:"q-mini-drawer-hide absolute",style:{top:"15px",right:"0px"}};function f(e,a,t,f,h,w){const b=(0,s.up)("q-btn"),W=(0,s.up)("q-toolbar-title"),q=(0,s.up)("q-icon"),y=(0,s.up)("q-item-section"),k=(0,s.up)("q-item"),S=(0,s.up)("q-toolbar"),I=(0,s.up)("q-avatar"),x=(0,s.up)("q-item-label"),C=(0,s.up)("q-field"),_=(0,s.up)("q-header"),Z=(0,s.up)("q-input"),j=(0,s.up)("q-footer"),V=(0,s.up)("q-scroll-area"),Q=(0,s.up)("q-list"),R=(0,s.up)("q-drawer"),H=(0,s.up)("router-view"),z=(0,s.up)("q-page-container"),U=(0,s.up)("q-layout");return(0,s.wg)(),(0,s.j4)(U,{view:"lHh LpR lFf"},{default:(0,s.w5)((()=>[(0,s.Wm)(_,{elevated:"",class:"bg-dark"},{default:(0,s.w5)((()=>[(0,s.Wm)(S,null,{default:(0,s.w5)((()=>["/"==e.$route.path?((0,s.wg)(),(0,s.j4)(b,{key:0,flat:"",onClick:a[1]||(a[1]=a=>e.drawer=!e.drawer),round:"",dense:"",icon:"menu"})):(0,s.kq)("",!0),(0,s.Wm)(W,null,{default:(0,s.w5)((()=>[l])),_:1}),(0,s.Wm)(k,{clickable:"",onClick:e.logout},{default:(0,s.w5)((()=>[(0,s.Wm)(y,null,{default:(0,s.w5)((()=>[(0,s.Wm)(q,{rounded:"",flat:"",name:"logout"})])),_:1})])),_:1},8,["onClick"])])),_:1}),"/"==e.$route.path&&e.clientSelected.username?((0,s.wg)(),(0,s.j4)(S,{key:0,inset:"",class:"bg-white text-primary q-pa-md"},{default:(0,s.w5)((()=>[(0,s.Wm)(C,{borderless:"","stack-label":"",class:"full-width"},{prepend:(0,s.w5)((()=>[(0,s.Wm)(I,null,{default:(0,s.w5)((()=>[e.clientSelected.avatar?((0,s.wg)(),(0,s.j4)("img",{key:0,src:`http://localhost:3000/uploads/${e.clientSelected.avatar}`},null,8,["src"])):(0,s.kq)("",!0)])),_:1})])),control:(0,s.w5)((()=>[(0,s.Wm)(y,null,{default:(0,s.w5)((()=>[(0,s.Wm)(x,{class:"text-h6"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,r.zw)(e.clientSelected&&e.clientSelected.username?e.clientSelected.username:""),1)])),_:1})])),_:1})])),append:(0,s.w5)((()=>[(0,s.Wm)(b,{title:e.voiceActive?"Detener transmisión de audio":"Iniciar transmisión de audio",icon:"mic",rounded:"",push:!e.voiceActive,color:"white","text-color":"primary",onClick:(0,n.iM)(e.sendVoice,["prevent"])},null,8,["title","push","onClick"])])),_:1})])),_:1})):(0,s.kq)("",!0)])),_:1}),"/"==e.$route.path&&e.clientSelected.username?((0,s.wg)(),(0,s.j4)(j,{key:0,class:"bg-white text-primary q-pa-md row"},{default:(0,s.w5)((()=>[(0,s.Wm)(Z,{onKeyup:(0,n.D2)(e.sendMessage,["enter"]),modelValue:e.msg,"onUpdate:modelValue":a[3]||(a[3]=a=>e.msg=a),modelModifiers:{trim:!0},class:"full-width",label:"Escribe un mensaje",outlined:"",type:"textarea"},{before:(0,s.w5)((()=>[(0,s.Wm)(I,null,{default:(0,s.w5)((()=>[(0,s.Wm)("img",{src:`http://localhost:3000/uploads/${e.userInfo.avatar}`},null,8,["src"])])),_:1})])),append:(0,s.w5)((()=>[e.msg?((0,s.wg)(),(0,s.j4)(q,{key:0,name:"close",onClick:a[2]||(a[2]=a=>e.msg=""),class:"cursor-pointer"})):(0,s.kq)("",!0),(0,s.Wm)(q,{name:"schedule"})])),after:(0,s.w5)((()=>[(0,s.Wm)(b,{onClick:(0,n.iM)(e.sendMessage,["prevent"]),disabled:!e.msg,round:"",dense:"",flat:"",icon:"send"},null,8,["onClick","disabled"])])),_:1},8,["onKeyup","modelValue"])])),_:1})):(0,s.kq)("",!0),"/"==e.$route.path?((0,s.wg)(),(0,s.j4)(R,{key:1,modelValue:e.drawer,"onUpdate:modelValue":a[10]||(a[10]=a=>e.drawer=a),"show-if-above":"",mini:!e.drawer||e.miniState,width:320,breakpoint:500,class:"bg-dark text-white"},{mini:(0,s.w5)((()=>[(0,s.Wm)(V,{class:"fit mini-slot cursor-pointer"},{default:(0,s.w5)((()=>[(0,s.Wm)("div",{class:"q-py-lg",onClickCapture:a[4]||(a[4]=a=>e.miniState=!e.miniState)},[(0,s.Wm)("div",o,[(0,s.Wm)(q,{name:"inbox",color:"blue",size:"md",class:"q-m-md"})])],32)])),_:1})])),default:(0,s.w5)((()=>[(0,s.Wm)(V,{class:"fit"},{default:(0,s.w5)((()=>[(0,s.Wm)(Q,{padding:""},{default:(0,s.w5)((()=>[(0,s.Wm)(Z,{dark:"",dense:"",standout:"",label:"Busca un usuario","input-class":"text-left",class:"q-ml-sm q-mr-lg q-pr-lg",modelValue:e.userInputSearch,"onUpdate:modelValue":a[7]||(a[7]=a=>e.userInputSearch=a),onKeyup:a[8]||(a[8]=(0,n.D2)((a=>e.userInputSearch.trim()&&e.userInputSearch.length>2?e.buscarUsuarios(e.userInputSearch):""),["enter"]))},{prepend:(0,s.w5)((()=>[(0,s.Wm)(q,{name:"search",onClick:a[5]||(a[5]=a=>e.userInputSearch.trim()&&e.userInputSearch.length>2?e.buscarUsuarios(e.userInputSearch):"")}),(0,s.Wm)(q,{name:"clear",class:"cursor-pointer",onClick:a[6]||(a[6]=a=>e.userInputSearch="")})])),_:1},8,["modelValue"]),e.userInputSearch.length||e.users.length?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(k,{key:0},{default:(0,s.w5)((()=>[u])),_:1})),e.userInputSearch.length&&!e.usersSearch.length?((0,s.wg)(),(0,s.j4)(k,{key:1},{default:(0,s.w5)((()=>[i])),_:1})):(0,s.kq)("",!0),((0,s.wg)(!0),(0,s.j4)(s.HY,null,(0,s.Ko)(e.userInputSearch.length?e.usersSearch:e.users,((a,t)=>((0,s.wg)(),(0,s.j4)(k,{clickable:"",active:e.clientSelected.username==a.username,"active-class":"bg-blue-grey-8",key:a+`${t}`,onClick:t=>{e.clientSelected.username=a.username,e.clientSelected.avatar=a.avatar,e.obtenerMensajesChat(e.userInfo,a)}},{default:(0,s.w5)((()=>[(0,s.Wm)("div",c,[(0,s.Wm)("div",m,[(0,s.Wm)("div",d,[(0,s.Wm)("div",p,[(0,s.Wm)(I,null,{default:(0,s.w5)((()=>[(0,s.Wm)("img",{src:`http://localhost:3000/uploads/${a.avatar}`},null,8,["src"])])),_:2},1024)]),(0,s.Wm)("div",g,[(0,s.Wm)("span",null,(0,r.zw)(a.username),1),(0,s.Wm)("span",null,(0,r.zw)(a.ultMsg?a.ultMsg.substring(0,10):""),1)])])])])])),_:2},1032,["active","onClick"])))),128))])),_:1})])),_:1}),(0,s.Wm)("div",v,[(0,s.Wm)(b,{dense:"",round:"",unelevated:"",color:"accent",icon:"chevron_left",onClick:a[9]||(a[9]=a=>e.miniState=!0)})])])),_:1},8,["modelValue","mini"])):(0,s.kq)("",!0),(0,s.Wm)(z,null,{default:(0,s.w5)((()=>[(0,s.Wm)(H,{messages:e.messages,userSelected:e.clientSelected,key:e.$route.fullPath,onRoomInfo:a[11]||(a[11]=a=>e.connectRoom(a)),onCreateRoom:a[12]||(a[12]=a=>e.createRoom(a))},null,8,["messages","userSelected"])])),_:1})])),_:1})}var h=t(9582),w=t(4773),b=t(52),W=t.n(b),q=t(4261),y=t(1959),k=t(797);const S=(0,w.ZP)("http://localhost:3000"),I=(0,s.aZ)({setup(){const e=(0,h.tv)(),a=(0,h.yj)(),t=(0,y.iH)(!1),r=(0,y.iH)(!1),n=(0,y.iH)(!1),l=(0,y.iH)([]),o=(0,y.iH)([]),u=(0,y.qj)({username:"",avatar:""}),i=(0,y.iH)(""),{notifySuccess:c,notifyError:m}=(0,k.alertsCustom)(),d=(0,y.iH)(""),p=(0,y.iH)(""),g=(0,y.iH)([]);let v=(0,q.V)();function f(){return localStorage.removeItem("user"),localStorage.removeItem("userInfo"),localStorage.removeItem("room"),e.push("/login")}function w(a){return console.log(a,"connectRoom"),e.push("/")}function b(a){return console.log(a,"createRoom"),e.push("/")}function I(){let e=!1;l.value.forEach((a=>{if(u.username==a.username)return l.value.map((e=>{if(a===e)return console.log("se actualizará el ultimo mensaje"),{username:u.username,avatar:u.avatar,ultMsg:d}})),e=!0})),e||l.value.push({username:u.username,avatar:u.avatar}),S.emit("message",{msg:d,userId:v.userId,username:v.username,avatar:v.avatar,to:u.username});const a={user:{username:v.username},message:d.value,createdAt:new Date,avatar:v.avatar};g.value.push(a),d.value=""}var x=!1;function C(){r.value=!r.value,x=!x,x&&c("Se empezó a emitir voz en tiempo real");const e={audio:!0};navigator.mediaDevices.getUserMedia(e).then((e=>{console.log("entro aqui");const a=new MediaRecorder(e);a.onstart=function(){this.chunks=[]},a.ondataavailable=function(e){this.chunks.push(e.data)},a.onstop=function(){const e=new Blob(this.chunks,{type:"audio/ogg; codecs=opus"});S.emit("radio",e)},x?window.playbackInterval=setInterval((function(){a.start(),setTimeout((function(){a.stop()}),990)}),1e3):(c("Se detuvo la emisión de voz en tiempo real"),clearInterval(window.playbackInterval))}))}function _(){S.emit("userActive",v)}function Z(){_(),Q(v.username),S.on("message",(e=>{console.log("se recibió mensaje",e);let a=!1;if(l.value.forEach((t=>{if(e.user==t.username)return l.value.map((a=>{if(t===a)return console.log("se actualizará el ultimo mensaje"),{username:e.user,avatar:e.avatar,ultMsg:e.msg}})),a=!0})),a||l.value.push({username:e.user,avatar:e.avatar,ultMsg:e.msg}),e.user=u.username){const a={user:{username:e.user},message:e.msg,createdAt:e.createdAt,avatar:e.avatar};g.value.push(a)}}))}function j(e,a){W().post("http://localhost:3000/api/message",{sender:e.username,receiver:a.username}).then((t=>{if(200==t.status){const s=t.data,r=s.map((t=>({user:{username:t.sender},message:t.message,createdAt:t.updatedAt,avatar:t.sender==e.username?e.avatar:a.avatar})));g.value=r}})).catch((()=>{m("Ha ocurrido un error inesperado, por favor intenta mas tarde.")}))}function V(e){W().post("http://localhost:3000/api/users",{username:e}).then((e=>{200==e.status&&(o.value=e.data.map((e=>({username:e.username,avatar:e.filePath}))),console.log(o.value))})).catch((()=>{m("Ha ocurrido un error inesperado, por favor intenta mas tarde.")}))}function Q(e){W().post("http://localhost:3000/api/conversation",{username:e}).then((e=>{if(200==e.status){const a=e.data.users.map((e=>({username:e.username,avatar:e.filePath}))),t=a.filter((e=>e.username!==v.username));l.value=t}})).catch((()=>{m("Ha ocurrido un error inesperado, por favor intenta mas tarde.")}))}return S.on("voice",(function(e){const a=new Blob([e],{type:"audio/ogg; codecs=opus"}),t=document.createElement("audio");t.src=window.URL.createObjectURL(a),t.play()})),(0,s.ic)((()=>{if("/"==a.path){const a=localStorage.getItem("user");if(!a)return e.push("/login");Z()}})),(0,s.bv)((()=>{if("/"==a.path){const a=localStorage.getItem("user");if(!a)return e.push("/login");Z()}})),{voiceActive:r,buscarUsuarios:V,createRoom:b,connectRoom:w,sendMessage:I,sendVoice:C,clientSelected:u,users:l,usersSearch:o,obtenerMensajesChat:j,userInputSearch:i,userInfo:v,messages:g,usersActiveGlobal:p,msg:d,drawer:t,miniState:n,logout:f}}});var x=t(9214),C=t(3812),_=t(9570),Z=t(4607),j=t(3747),V=t(3414),Q=t(2035),R=t(4554),H=t(6115),z=t(5096),U=t(2350),M=t(1762),A=t(2426),T=t(223),D=t(7704),$=t(7011),E=t(2652),F=t(7518),O=t.n(F);I.render=f;const L=I;O()(I,"components",{QLayout:x.Z,QHeader:C.Z,QToolbar:_.Z,QBtn:Z.Z,QToolbarTitle:j.Z,QItem:V.Z,QItemSection:Q.Z,QIcon:R.Z,QField:H.Z,QAvatar:z.Z,QItemLabel:U.Z,QFooter:M.Z,QInput:A.Z,QDrawer:T.Z,QScrollArea:D.Z,QList:$.Z,QPageContainer:E.Z})},797:(e,a,t)=>{"use strict";t.r(a),t.d(a,{alertsCustom:()=>b,default:()=>R});var s=t(3673),r=t(2323),n=t(8880);const l=(0,s.HX)("data-v-7a4e9280");(0,s.dD)("data-v-7a4e9280");const o={class:"container bg-custom"},u={class:"abs-center"},i={class:"text-h5 text-center"},c={class:"q-mt-lg"},m=(0,s.Wm)("span",null," o ",-1);(0,s.Cn)();const d=l(((e,a,t,d,p,g)=>{const v=(0,s.up)("q-resize-observer"),f=(0,s.up)("q-img"),h=(0,s.up)("q-input"),w=(0,s.up)("q-icon"),b=(0,s.up)("q-file"),W=(0,s.up)("q-btn"),q=(0,s.up)("q-form"),y=(0,s.up)("q-card-section"),k=(0,s.up)("q-card"),S=(0,s.up)("q-page");return(0,s.wg)(),(0,s.j4)(S,null,{default:l((()=>[(0,s.Wm)("div",o,[(0,s.Wm)(v,{onResize:e.onResize},null,8,["onResize"]),(0,s.Wm)("div",u,[(0,s.Wm)(k,{class:"my-card q-m-lg",flat:"",bordered:""},{default:l((()=>[(0,s.Wm)(y,{horizontal:e.windowWidth>400},{default:l((()=>[e.isRegister?((0,s.wg)(),(0,s.j4)(f,{key:0,class:"col-5",src:"https://cdn.quasar.dev/img/parallax2.jpg"})):(0,s.kq)("",!0),(0,s.Wm)(y,null,{default:l((()=>[(0,s.Wm)("h4",i,(0,r.zw)(e.textContextTitle),1),(0,s.Wm)(q,{onSubmit:(0,n.iM)(e.validateValues,["prevent"])},{default:l((()=>[(0,s.Wm)(h,{class:"q-mt-sm",dense:!0,rounded:"",type:"text",outlined:"",modelValue:e.user.username,"onUpdate:modelValue":a[1]||(a[1]=a=>e.user.username=a),label:"Usuario",rules:[e=>e&&e.length>0||"Introduce tu nombre de usuario"]},null,8,["modelValue","rules"]),e.isRegister?((0,s.wg)(),(0,s.j4)(h,{key:0,class:"q-mt-sm",dense:!0,rounded:"",type:"emaiil",outlined:"",modelValue:e.user.email,"onUpdate:modelValue":a[2]||(a[2]=a=>e.user.email=a),label:"Correo electrónico",rules:[e=>e&&e.length>0&&e.includes("@")||"Introduce tu correo"]},null,8,["modelValue","rules"])):(0,s.kq)("",!0),(0,s.Wm)(h,{class:"q-mt-sm q-mb-sm",dense:!0,rounded:"",type:"password",outlined:"",modelValue:e.user.password,"onUpdate:modelValue":a[3]||(a[3]=a=>e.user.password=a),label:"Contraseña...",rules:[e=>e&&e.length>0||"Introduce tu contraseña"]},null,8,["modelValue","rules"]),e.isRegister?((0,s.wg)(),(0,s.j4)(b,{key:1,class:"q-mt-sm q-mb-sm",dense:!0,rounded:"",outlined:"","bottom-slots":"",modelValue:e.file,"onUpdate:modelValue":a[5]||(a[5]=a=>e.file=a),label:"Selecciona una foto de perfil",counter:"","max-files":"1"},{append:l((()=>[null!==e.file?((0,s.wg)(),(0,s.j4)(w,{key:0,name:"close",onClick:a[4]||(a[4]=(0,n.iM)((a=>e.file=null),["stop"])),class:"cursor-pointer"})):(0,s.kq)("",!0)])),_:1},8,["modelValue"])):(0,s.kq)("",!0),(0,s.Wm)("span",c,[(0,s.Wm)(W,{push:"",type:"submit",color:"primary",label:e.textContextTitle},null,8,["label"]),m,(0,s.Wm)("a",{onClick:a[6]||(a[6]=a=>e.isRegister=!e.isRegister),class:"text-blue"},(0,r.zw)(e.textContextTitleOpposite),1)])])),_:1},8,["onSubmit"])])),_:1}),e.isRegister?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(f,{key:1,class:"col-5",src:"https://cdn.quasar.dev/img/parallax2.jpg"}))])),_:1},8,["horizontal"])])),_:1})])])])),_:1})}));var p=t(1959),g=t(9582),v=t(52),f=t.n(v),h=t(8825),w=t(51);const b=()=>{const e=(0,h.Z)(),a=a=>e.notify({type:"positive",message:a}),t=a=>e.notify({type:"warning",message:a}),s=a=>e.notify({type:"negative",message:a}),r=a=>e.notify({type:"info",message:a});return{notifySuccess:a,notifyError:s,notifyWarning:t,notifyInfo:r}},W=(0,s.aZ)({name:"PageAbout",setup(){const{notifySuccess:e,notifyError:a,notifyWarning:t}=b(),r=(0,g.tv)(),n=(0,p.qj)({username:"",password:"",email:""}),l=(0,p.iH)(null),o=(0,p.iH)(window.innerWidth),u=(0,p.iH)(!1),i=(0,s.Fl)((()=>u.value?"Registrarse":"Iniciar sesión")),c=(0,s.Fl)((()=>u.value?"Iniciar sesión":"Registrarse"));function m(e){o.value=e.width}function d(){if(u.value){if(!l.value)return t("Selecciona una imagen de perfil para continuar");var s=new FormData;s.append("username",n.username),s.append("password",n.password),s.append("email",n.email),s.append("file",l.value),s.append("roles",JSON.stringify(["admin"])),f().post("http://localhost:3000/auth/register",s).then((a=>{200==a.status?(e("Registrado con exito"),u.value=!1):t("Valida tus datos")})).catch((()=>{a("Ha ocurrido un error inesperado, por favor intenta mas tarde.")}))}else f().post("http://localhost:3000/auth/login",{username:n.username,password:n.password}).then((a=>{if(200==a.status){if(a.data&&a.data.accessToken){localStorage.setItem("user",JSON.stringify(a.data));var s=a.data.accessToken,n=(0,w.Z)(s);localStorage.setItem("userInfo",JSON.stringify(n))}e("Logueado con exito"),r.go(NaN)}else t("Valida tus datos")})).catch((()=>{a("Ha ocurrido un error inesperado, por favor intenta mas tarde.")}))}return(0,s.bv)((()=>{const e=localStorage.getItem("user");if(e)return r.push("/")})),{windowWidth:o,onResize:m,user:n,file:l,validateValues:d,isRegister:u,textContextTitle:i,textContextTitleOpposite:c}}});var q=t(4379),y=t(5151),k=t(151),S=t(5589),I=t(4027),x=t(8689),C=t(2426),_=t(4816),Z=t(4554),j=t(4607),V=t(7518),Q=t.n(V);W.render=d,W.__scopeId="data-v-7a4e9280";const R=W;Q()(W,"components",{QPage:q.Z,QResizeObserver:y.Z,QCard:k.Z,QCardSection:S.Z,QImg:I.Z,QForm:x.Z,QInput:C.Z,QFile:_.Z,QIcon:Z.Z,QBtn:j.Z})}}]);